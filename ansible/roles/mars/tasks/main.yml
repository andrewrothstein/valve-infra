---
- name: mars container service
  ansible.builtin.include_role:
    name: "systemd_podman"
  vars:
    container_name: "mars"
    container_service_target: infra.target
    container_image: registry.freedesktop.org/mupuf/mars
    container_env_files:
      - "{{ base_config_env_file }}"
    optional_container_env_files:
      - "{{ config_env_file }}"
    container_ports:
      - "{{ mars_port }}:80/tcp"
    container_volumes:
      - "/mnt:/mnt"
    part_of:
      - "infra.service"

- name: configuring env
  become: true
  ansible.builtin.blockinfile:
    create: true
    path: "{{ base_config_env_file }}"
    mode: '0644'
    marker: "# {mark} ANSIBLE MANAGED BLOCK {{ role_name }}"
    block: |
      MARS_HOST={{ private_interface_ip }}
      MARS_DEBUG=True
      MARS_SQLITE_PATH={{ perm_mount }}/mars.sqlite3
      MARS_URL=http://{{ private_interface_ip }}:{{ mars_port }}
      MARS_SECRET_KEY={{ lookup('community.general.random_string', length=12, special=false) }}
