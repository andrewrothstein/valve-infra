- hosts: gateway
  vars:
    ansible_connection: local
    tmp_mount: /mnt/tmp
    perm_mount: /mnt/permanent
    prod_env_file: "{{ perm_mount }}/infra.env"
    config_env_file: "{{ perm_mount }}/config.env"

    salad_port: 8005
    minio_port: 9000

    minio_root_user: minioadmin
    dut_b2c_version: "boot2container_2021_09_09.cpio.xz"
    dut_kernel_version: "default_kernel_2021_09_09"

    whitelisted_domains:
      # Arch Linux / system admin
      - ntp.org
      - archlinux.thaller.ws
      - alpinelinux.org

      # CI valve-infra
      - debian.org
      - docker.com
      - docker.io
      - freedesktop.org
      - gitlab.freedesktop.org
      - kernel.org
      - minio.io

      # others (cdn, etc)
      - amazonaws.com
      - fastlydns.net
      - files.pythonhosted.org
      - mirror.lty.me
      - packet.net
      - phinau.de
      - pypi.org
      - pythonhosted.org
      - ripe.net
      - steamos.cloud
      - storage.googleapis.com
      - tedata.net

  roles:
    - base
    - firewall
    - ntpd
    - dnsmasq
    - dashboard
    - autologin
    - role: systemd_target
      tags: systemd_target
      vars:
        target_name: infra
        target_description: Valve Infra
        target_after:
          - multi-user.target
        target_wantedby: multi-user.target
    - salad
    - minio
